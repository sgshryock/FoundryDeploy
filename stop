#!/bin/bash
set -e
set -o pipefail

# Source common functions
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
source "$SCRIPT_DIR/lib/common.sh"

echo "=== Stopping Foundry VTT ==="
echo

# Check for docker compose
check_docker_compose || exit 1

# Check if containers are running
if ! docker compose ps --quiet 2>/dev/null | grep -q .; then
    echo "No containers are running."
    exit 0
fi

echo "Stopping containers..."
docker compose down

echo
echo "=== Foundry VTT Stopped ==="
echo
echo "Data is preserved in the Docker volume."
echo "To remove all data, run: docker compose down -v"
echo
echo "Note: nginx is still running. To stop it:"
if [ "$DEPLOY_SERVICE_MANAGER" = "systemd" ]; then
    echo "  sudo systemctl stop nginx"
else
    echo "  sudo nginx -s stop"
fi
echo
